{"version":3,"sources":["file:///Users/abhishekrawat/tiledMap2/assets/Script/PlayerMovement.ts"],"names":["_decorator","Component","Node","UITransform","Vec3","Vec2","Animation","ccclass","property","PlayerMovement","type","pos","startPos","stopPlayer","intialPos","finalPosBall","finalPos","start","touchEventsFunc","onLoad","node","getPosition","joyStickBall","on","EventType","TOUCH_START","touchStart","TOUCH_MOVE","touchMove","TOUCH_END","touchEnd","TOUCH_CANCEL","console","log","setPosition","e","parent","getComponent","convertToNodeSpaceAR","getUILocation","x","y","z","len","length","joyStickBallBaseWidth","getBoundingBox","width","dy","dx","angleRad","Math","atan2","angleDeg","PI","getDirection","angle","playWalkAnmation","walkDirection","play","changeSprite","update","deltaTime","playerPosition","currentPostion","lerp"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, UITransform, Vec3, Vec2, Animation } from \"cc\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"PlayerMovement\")\nexport class PlayerMovement extends Component {\n    @property({ type: Node })\n    joystick: Node = null;\n    @property({ type: Node })\n    joyStickBall: Node = null;\n    pos: Vec2 = null;\n    startPos: Vec3 = null;\n    stopPlayer: boolean = true;\n    intialPos: Vec3 = null;\n    finalPosBall: Vec3 = null;\n    finalPos: Vec3 = null;\n    start() {\n        this.touchEventsFunc();\n    }\n    onLoad() {\n        this.finalPosBall = new Vec3(1, 1, 0);\n        this.finalPos = this.node.getPosition();\n        this.intialPos = new Vec3(1, 1, 0);\n        this.startPos = this.joyStickBall.getPosition();\n    }\n    touchEventsFunc() {\n        this.joyStickBall.on(Node.EventType.TOUCH_START, this.touchStart, this);\n        this.joyStickBall.on(Node.EventType.TOUCH_MOVE, this.touchMove, this);\n        this.joyStickBall.on(Node.EventType.TOUCH_END, this.touchEnd, this);\n        this.joyStickBall.on(Node.EventType.TOUCH_CANCEL, this.touchEnd, this);\n    }\n    touchEnd() {\n        this.stopPlayer = false;\n        console.log(\"end\");\n        this.joyStickBall.setPosition(0, 0, 0);\n    }\n    touchStart() {\n        this.joyStickBall.setPosition(0, 0, 0);\n        console.log(\"start\");\n    }\n    touchMove(e) {\n        this.stopPlayer = true;\n        this.intialPos = this.joyStickBall.parent\n            .getComponent(UITransform)\n            .convertToNodeSpaceAR(new Vec3(e.getUILocation().x, e.getUILocation().y, e.getUILocation().z));\n        // var finalPosBall: Vec3;\n        var len = this.intialPos.length();\n        console.log(\"len\", len);\n        var joyStickBallBaseWidth = this.joyStickBall.parent.getComponent(UITransform).getBoundingBox().width / 2;\n        if (len > joyStickBallBaseWidth) {\n            this.intialPos.x = (this.intialPos.x * joyStickBallBaseWidth) / len;\n            this.intialPos.y = (this.intialPos.y * joyStickBallBaseWidth) / len;\n        }\n\n        var dy = this.intialPos.y;\n        var dx = this.intialPos.x;\n        var angleRad = Math.atan2(dy, dx);\n        var angleDeg = (angleRad * 180) / Math.PI;\n        console.log(\"angle \", angleDeg, angleRad);\n        this.getDirection(angleDeg);\n        this.joyStickBall.setPosition(this.intialPos);\n    }\n    getDirection(angle) {\n        if (angle > -15 && angle < 15) {\n            this.playWalkAnmation(\"East\");\n        } else if (angle > 15 && angle < 75) {\n            this.playWalkAnmation(\"North_East\");\n        } else if (angle > 75 && angle < 105) {\n            this.playWalkAnmation(\"North\");\n        } else if (angle > 105 && angle < 165) {\n            this.playWalkAnmation(\"North_West\");\n        } else if (angle > 165 && angle < 195) {\n            this.playWalkAnmation(\"West\");\n        } else if (angle > 195 && angle < 255) {\n            this.playWalkAnmation(\"South_West\");\n        } else if (angle > 255 && angle > 285) {\n            this.playWalkAnmation(\"South\");\n        } else {\n            this.playWalkAnmation(\"South_East\");\n        }\n    }\n    playWalkAnmation(walkDirection: String) {\n        switch (walkDirection) {\n            case \"North\":\n                {\n                    console.log(walkDirection);\n                    this.node.getComponent(Animation)?.play(\"north\");\n                }\n                break;\n            case \"East\":\n                {\n                    console.log(walkDirection);\n                    this.node.getComponent(Animation)?.play(\"east\");\n                }\n                break;\n            case \"South\":\n                {\n                    console.log(walkDirection);\n                    this.node.getComponent(Animation)?.play(\"south\");\n                }\n                break;\n            case \"West\":\n                {\n                    console.log(walkDirection);\n                    this.node.getComponent(Animation)?.play(\"west\");\n                }\n                break;\n            case \"North_East\":\n                {\n                    console.log(walkDirection);\n                    this.node.getComponent(Animation)?.play(\"northEast\");\n                }\n                break;\n            case \"North_West\":\n                {\n                    console.log(walkDirection);\n                    this.node.getComponent(Animation)?.play(\"northWest\");\n                }\n                break;\n            case \"South_East\":\n                {\n                    console.log(walkDirection);\n                    this.node.getComponent(Animation)?.play(\"southEast\");\n                }\n                break;\n            case \"South_West\":\n                {\n                    console.log(walkDirection);\n                    this.node.getComponent(Animation)?.play(\"southWest\");\n                }\n                break;\n        }\n    }\n    changeSprite() {}\n    update(deltaTime: number) {\n        if (this.stopPlayer) {\n            this.pos = new Vec2(this.startPos.x - this.intialPos.x, this.startPos.y - this.intialPos.y);\n            this.finalPos.x -= this.pos.x * 0.01;\n            this.finalPos.y -= this.pos.y * 0.01;\n            this.pos.x = 0;\n            this.pos.y = 0;\n        }\n\n        let playerPosition = new Vec3();\n        let currentPostion: Vec3 = this.node.getPosition();\n        Vec3.lerp(playerPosition, currentPostion, this.finalPos, 0.06);\n        this.node.setPosition(playerPosition);\n    }\n}\n"]}